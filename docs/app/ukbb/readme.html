<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>README &mdash; CCITK  documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/sphinx_highlight.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="SLURM" href="../slurm/index.html" />
    <link rel="prev" title="UKBB" href="index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html" class="icon icon-home"> CCITK
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../api/index.html">API</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Applications</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../cmr_segment/index.html">CMRSegment</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">UKBB</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#">README</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#introduction">Introduction</a></li>
<li class="toctree-l4"><a class="reference internal" href="#dependencies">Dependencies</a></li>
<li class="toctree-l4"><a class="reference internal" href="#modules">Modules</a></li>
<li class="toctree-l4"><a class="reference internal" href="#slurm-cpu-gpu-clusters">SLURM - CPU/GPU clusters</a></li>
<li class="toctree-l4"><a class="reference internal" href="#miscellaneous">Miscellaneous</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../slurm/index.html">SLURM</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">CCITK</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Applications</a></li>
          <li class="breadcrumb-item"><a href="index.html">UKBB</a></li>
      <li class="breadcrumb-item active">README</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/app/ukbb/readme.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="readme">
<h1>README<a class="headerlink" href="#readme" title="Permalink to this heading"></a></h1>
<section id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this heading"></a></h2>
<p>This application consists of four modules: <code class="docutils literal notranslate"><span class="pre">download</span></code>, <code class="docutils literal notranslate"><span class="pre">convert</span></code>, <code class="docutils literal notranslate"><span class="pre">segment</span></code>, and <code class="docutils literal notranslate"><span class="pre">analyze</span></code>.</p>
<p><code class="docutils literal notranslate"><span class="pre">download</span></code> is to fetch bulk DICOM image data from UKBB;
<code class="docutils literal notranslate"><span class="pre">convert</span></code> is to unzip and convert them to NIFTY images;
<code class="docutils literal notranslate"><span class="pre">segment</span></code> is to segment long-axis (LA), short-axis (SA) and aortic (AO) images using 2D networks;
dnd <code class="docutils literal notranslate"><span class="pre">analyze</span></code> is to analyze segmentations and extract informations such as
volumes of the atrial and ventricle, strains, wall thickness abd aortic area.</p>
</section>
<section id="dependencies">
<h2>Dependencies<a class="headerlink" href="#dependencies" title="Permalink to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="n">pandas</span> <span class="n">tqdm</span> <span class="n">numpy</span> <span class="n">scipy</span> <span class="n">nibabel</span> <span class="n">opencv</span><span class="o">-</span><span class="n">python</span> <span class="n">pydicom</span> <span class="n">SimpleVTK</span> <span class="n">scikit</span><span class="o">-</span><span class="n">image</span> <span class="n">vtk</span>
</pre></div>
</div>
<p>It requires tensorflow for segmentation. The code was written for tensorflow 1, but it also now
back support tensorflow 2.</p>
<p>It also requires <code class="docutils literal notranslate"><span class="pre">MIRTK</span></code> and <code class="docutils literal notranslate"><span class="pre">average_3d_ffd</span></code> in the <code class="docutils literal notranslate"><span class="pre">analyze</span></code> module. Add their paths to your <code class="docutils literal notranslate"><span class="pre">PATH</span></code> variable,
for example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span># MIRTK
export PATH=&quot;$PATH:/vol/biomedic2/wbai/git/MIRTK_bin/bin&quot;

# average_3d_ffd
export PATH=$PATH:/vol/biomedic2/wbai/git/ukbb_cardiac/third_party/ubuntu_16.04_bin/
</pre></div>
</div>
</section>
<section id="modules">
<h2>Modules<a class="headerlink" href="#modules" title="Permalink to this heading"></a></h2>
<section id="download">
<h3>download<a class="headerlink" href="#download" title="Permalink to this heading"></a></h3>
<p>Command line command</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ccitk</span><span class="o">-</span><span class="n">ukbb</span><span class="o">-</span><span class="n">download</span>
<span class="o">--</span><span class="n">csv</span><span class="o">-</span><span class="n">file</span> <span class="o">/</span><span class="n">vol</span><span class="o">/</span><span class="n">biodata</span><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">biobank</span><span class="o">/</span><span class="mi">40616</span><span class="o">/</span><span class="n">csv</span><span class="o">/</span><span class="n">ukbb_40616_new_eids</span><span class="o">.</span><span class="n">csv</span>
<span class="o">--</span><span class="n">fields</span> <span class="n">sa</span> <span class="n">la</span> <span class="n">ao</span>
<span class="o">--</span><span class="n">key</span><span class="o">-</span><span class="n">path</span> <span class="o">/</span><span class="n">vol</span><span class="o">/</span><span class="n">biodata</span><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">biobank</span><span class="o">/</span><span class="mi">40616</span><span class="o">/</span><span class="n">key</span><span class="o">/</span><span class="n">ukbb</span><span class="o">.</span><span class="n">key</span>
<span class="o">--</span><span class="n">ukbfetch</span><span class="o">-</span><span class="n">path</span> <span class="o">/</span><span class="n">vol</span><span class="o">/</span><span class="n">biodata</span><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">biobank</span><span class="o">/</span><span class="mi">40616</span><span class="o">/</span><span class="n">utils</span><span class="o">/</span><span class="n">ukbfetch</span>
<span class="o">--</span><span class="n">output</span><span class="o">-</span><span class="nb">dir</span> <span class="o">/</span><span class="n">vol</span><span class="o">/</span><span class="n">biodata</span><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">biobank</span><span class="o">/</span><span class="mi">40616</span><span class="o">/</span><span class="n">output</span><span class="o">/</span><span class="n">images</span><span class="o">/</span>
</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">--csv-file</span></code> specifiles the location of a csv file that contains a list of eids to be processed in a column.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--fields</span></code> specifies what images to download. You can choose one or more from three options: [sa, la, ao], where
sa stands for short-axis images, la is long-axis images, and ao is aortic images.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--key-path</span></code> specifies the ukbb key path</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--ukbfetch-path</span></code> specifies the location of the ukbfetch command</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--output-dir</span></code> specifies where to output</p></li>
</ul>
<p>Important: This command has to run when you are inside the <span class="xref myst">ccitk/ukbb/download</span> directory</p>
</section>
<section id="convert">
<h3>convert<a class="headerlink" href="#convert" title="Permalink to this heading"></a></h3>
<p>Command line command</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ccitk</span><span class="o">-</span><span class="n">ukbb</span><span class="o">-</span><span class="n">convert</span>
<span class="o">--</span><span class="n">csv</span><span class="o">-</span><span class="n">file</span> <span class="o">/</span><span class="n">vol</span><span class="o">/</span><span class="n">biodata</span><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">biobank</span><span class="o">/</span><span class="mi">40616</span><span class="o">/</span><span class="n">csv</span><span class="o">/</span><span class="n">ukbb_40616_new_eids</span><span class="o">.</span><span class="n">csv</span>
<span class="o">--</span><span class="n">fields</span> <span class="n">sa</span> <span class="n">la</span> <span class="n">ao</span>
<span class="o">--</span><span class="nb">input</span><span class="o">-</span><span class="nb">dir</span> <span class="o">/</span><span class="n">vol</span><span class="o">/</span><span class="n">biodata</span><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">biobank</span><span class="o">/</span><span class="mi">40616</span><span class="o">/</span><span class="n">output</span><span class="o">/</span><span class="n">images</span><span class="o">/</span><span class="nb">zip</span><span class="o">/</span>
<span class="o">--</span><span class="n">output</span><span class="o">-</span><span class="nb">dir</span> <span class="o">/</span><span class="n">vol</span><span class="o">/</span><span class="n">biodata</span><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">biobank</span><span class="o">/</span><span class="mi">40616</span><span class="o">/</span><span class="n">output</span><span class="o">/</span><span class="n">images</span><span class="o">/</span>
</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">--csv-file</span></code> specifiles the location of a csv file that contains a list of eids to be processed in a column.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--fields</span></code> specifies what images to convert. You can choose one or more from three options: sa la ao, where
sa stands for short-axis images, la is long-axis images, and ao is aortic images.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--input-dir</span></code> specifies the location of zip files</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--output-dir</span></code> specifies where to output, which are a folder of dicom images, and a folder of nii images.</p></li>
</ul>
</section>
<section id="segment">
<h3>segment<a class="headerlink" href="#segment" title="Permalink to this heading"></a></h3>
<p>To use prebuilt tensorflow 1</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>export PYTHONPATH=$PYTHONPATH:/vol/biomedic2/wbai/git/
</pre></div>
</div>
<p>Command line command</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ccitk</span><span class="o">-</span><span class="n">ukbb</span><span class="o">-</span><span class="n">segment</span>
<span class="o">--</span><span class="n">csv</span><span class="o">-</span><span class="n">file</span> <span class="o">/</span><span class="n">vol</span><span class="o">/</span><span class="n">biodata</span><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">biobank</span><span class="o">/</span><span class="mi">40616</span><span class="o">/</span><span class="n">csv</span><span class="o">/</span><span class="n">ukbb_40616_new_eids</span><span class="o">.</span><span class="n">csv</span>
<span class="o">--</span><span class="n">process</span><span class="o">-</span><span class="n">seq</span> <span class="o">--</span><span class="n">save</span><span class="o">-</span><span class="n">seg</span>
<span class="o">--</span><span class="n">data</span><span class="o">-</span><span class="nb">dir</span> <span class="o">/</span><span class="n">vol</span><span class="o">/</span><span class="n">biodata</span><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">biobank</span><span class="o">/</span><span class="mi">40616</span><span class="o">/</span><span class="n">output</span><span class="o">/</span><span class="n">images</span><span class="o">/</span><span class="n">nii</span><span class="o">/</span>
<span class="o">--</span><span class="n">model</span> <span class="n">sa</span>  <span class="c1"># choose from sa, la_2ch, la_4ch, la_4ch_seg4, ao</span>
</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">--csv-file</span></code> specifiles the location of a csv file that contains a list of eids to be processed in a column.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--process-seq</span></code> whether to process the whole cine sequence or just ED ES. This should always be supplied,
as we always need the whole cine segmentations for analysis</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--save-seg</span></code> whether to save segmentations. Always should be supplied.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--model</span></code> specifies what model to use. You can choose 1 from 5 options: [“sa”, “ao”, “la_2ch”, “la_4ch”, “la_4ch_seg4”], where
sa stands for short-axis model, la is long-axis model, and ao is aortic model.</p></li>
</ul>
<p>The complete list of model paths are listed in below for reference. They have been hard coded so we do not need to supple
anything else, other than the name of the model [“sa”, “ao”, “la_2ch”, “la_4ch”, “la_4ch_seg4”]:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sa</span><span class="o">-</span><span class="n">model</span><span class="o">-</span><span class="n">path</span> <span class="o">/</span><span class="n">vol</span><span class="o">/</span><span class="n">biomedic2</span><span class="o">/</span><span class="n">wbai</span><span class="o">/</span><span class="n">git</span><span class="o">/</span><span class="n">ukbb_cardiac</span><span class="o">/</span><span class="n">trained_model</span><span class="o">/</span><span class="n">FCN_sa</span>
<span class="n">la</span><span class="o">-</span><span class="mi">2</span><span class="n">ch</span><span class="o">-</span><span class="n">model</span><span class="o">-</span><span class="n">path</span> <span class="o">/</span><span class="n">vol</span><span class="o">/</span><span class="n">biomedic2</span><span class="o">/</span><span class="n">wbai</span><span class="o">/</span><span class="n">git</span><span class="o">/</span><span class="n">ukbb_cardiac</span><span class="o">/</span><span class="n">trained_model</span><span class="o">/</span><span class="n">FCN_la_2ch</span>
<span class="n">la</span><span class="o">-</span><span class="mi">4</span><span class="n">ch</span><span class="o">-</span><span class="n">model</span><span class="o">-</span><span class="n">path</span> <span class="o">/</span><span class="n">vol</span><span class="o">/</span><span class="n">biomedic2</span><span class="o">/</span><span class="n">wbai</span><span class="o">/</span><span class="n">git</span><span class="o">/</span><span class="n">ukbb_cardiac</span><span class="o">/</span><span class="n">trained_model</span><span class="o">/</span><span class="n">FCN_la_4ch</span>
<span class="n">la</span><span class="o">-</span><span class="mi">4</span><span class="n">ch</span><span class="o">-</span><span class="n">seg4</span><span class="o">-</span><span class="n">model</span><span class="o">-</span><span class="n">path</span> <span class="o">/</span><span class="n">vol</span><span class="o">/</span><span class="n">biomedic2</span><span class="o">/</span><span class="n">wbai</span><span class="o">/</span><span class="n">git</span><span class="o">/</span><span class="n">ukbb_cardiac</span><span class="o">/</span><span class="n">trained_model</span><span class="o">/</span><span class="n">FCN_la_4ch_seg4_modified</span>
<span class="n">ao</span><span class="o">-</span><span class="n">model</span><span class="o">-</span><span class="n">path</span> <span class="o">/</span><span class="n">vol</span><span class="o">/</span><span class="n">biomedic2</span><span class="o">/</span><span class="n">wbai</span><span class="o">/</span><span class="n">git</span><span class="o">/</span><span class="n">ukbb_cardiac</span><span class="o">/</span><span class="n">trained_model</span><span class="o">/</span><span class="n">UNet</span><span class="o">-</span><span class="n">LSTM_ao_modified</span>
</pre></div>
</div>
<p>You can only run one model at a time. To finish the segmentation process, make sure to run all 5 models.</p>
</section>
<section id="analyze">
<h3>analyze<a class="headerlink" href="#analyze" title="Permalink to this heading"></a></h3>
<p>Command line command</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ccitk</span><span class="o">-</span><span class="n">ukbb</span><span class="o">-</span><span class="n">analyze</span>
<span class="o">--</span><span class="n">csv</span><span class="o">-</span><span class="n">file</span> <span class="o">/</span><span class="n">vol</span><span class="o">/</span><span class="n">biodata</span><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">biobank</span><span class="o">/</span><span class="mi">40616</span><span class="o">/</span><span class="n">csv</span><span class="o">/</span><span class="n">ukbb_40616_new_eids</span><span class="o">.</span><span class="n">csv</span>
<span class="o">--</span><span class="n">sa</span> <span class="o">--</span><span class="n">la</span> <span class="o">--</span><span class="n">ao</span> <span class="o">--</span><span class="n">data</span><span class="o">-</span><span class="nb">dir</span> <span class="o">/</span><span class="n">vol</span><span class="o">/</span><span class="n">biodata</span><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">biobank</span><span class="o">/</span><span class="mi">40616</span><span class="o">/</span><span class="n">output</span><span class="o">/</span><span class="n">images</span><span class="o">/</span><span class="n">nii</span>
<span class="o">--</span><span class="n">output</span><span class="o">-</span><span class="nb">dir</span> <span class="o">/</span><span class="n">vol</span><span class="o">/</span><span class="n">biodata</span><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">biobank</span><span class="o">/</span><span class="mi">40616</span><span class="o">/</span><span class="n">output</span><span class="o">/</span>
<span class="c1"># if --ao</span>
<span class="o">--</span><span class="n">pressure</span><span class="o">-</span><span class="n">csv</span> <span class="o">/</span><span class="n">vol</span><span class="o">/</span><span class="n">biodata</span><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">biobank</span><span class="o">/</span><span class="mi">40616</span><span class="o">/</span><span class="n">csv</span><span class="o">/</span><span class="n">ukb52223_image_subset</span><span class="o">.</span><span class="n">csv</span>
</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">--csv-file</span></code> specifiles the location of a csv file that contains a list of eids to be processed in a column.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--data-dir</span></code> specifiles the location of nii images</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--sa</span></code>: whether to run short-axis analysis</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--la</span></code>, whether to run long-axis analysis</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--ao</span></code> whether to run aortic analysis</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--output-dir</span></code> location to output csv files</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--pressure-csv</span></code>: if –ao, then need to supple the location of a csv file that contains the blood pressure of each subject</p></li>
</ul>
</section>
</section>
<section id="slurm-cpu-gpu-clusters">
<h2>SLURM - CPU/GPU clusters<a class="headerlink" href="#slurm-cpu-gpu-clusters" title="Permalink to this heading"></a></h2>
<p>To run above commands for tens of thousands of subjects take an enormous amount of time, months maybe. So we must utilise
HPC clusters to parallel these computations.</p>
<p>To submit a SLURM job, it is very easy,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ccitk</span><span class="o">-</span><span class="n">slurm</span><span class="o">-</span><span class="n">submit</span> <span class="o">--</span><span class="n">batch</span><span class="o">-</span><span class="n">conf</span> <span class="o">/</span><span class="n">path</span><span class="o">-</span><span class="n">to</span><span class="o">-</span><span class="n">batch</span><span class="o">.</span><span class="n">conf</span>
</pre></div>
</div>
<p>See more information in <span class="xref myst">ccitk/slurm</span> package</p>
<p>In the batch.conf, you need to fill out the following fields</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">batch</span> <span class="p">{</span>
  <span class="n">job_type</span> <span class="o">=</span> <span class="s2">&quot;cpu&quot;</span>  <span class="c1"># or &quot;gpu&quot;</span>
  <span class="n">job_script_path</span> <span class="o">=</span> <span class="s2">&quot;/path-to-python-script&quot;</span>  <span class="c1"># or command line command</span>
  <span class="n">job_args</span> <span class="o">=</span> <span class="s2">&quot;--key value --other-options&quot;</span> <span class="c1"># all but --csv-file</span>
  <span class="n">csv_file</span> <span class="o">=</span> <span class="s2">&quot;/path-to-the-main-eid-csv&quot;</span>
  <span class="n">partition_csv_dir</span> <span class="o">=</span> <span class="s2">&quot;/directory-to-store-the-partitioned-eid-csvs&quot;</span>
  <span class="n">venv_activate_path</span> <span class="o">=</span> <span class="s2">&quot;/homes/sli9/venv/bin/activate&quot;</span>
  <span class="n">jobs</span> <span class="o">=</span> <span class="p">[</span>
    <span class="c1"># cpu job</span>
    <span class="p">{</span>
      <span class="n">n_cpu</span> <span class="o">=</span> <span class="mi">16</span>
      <span class="n">mem</span> <span class="o">=</span> <span class="mi">12288</span>
      <span class="n">nodelist</span> <span class="o">=</span> <span class="s2">&quot;roc01&quot;</span>
    <span class="p">},</span>
    <span class="c1"># or gpu job</span>
    <span class="p">{</span>
      <span class="n">n_cpu</span> <span class="o">=</span> <span class="mi">4</span>
      <span class="n">mem</span> <span class="o">=</span> <span class="mi">12288</span>
      <span class="n">nodelist</span> <span class="o">=</span> <span class="s2">&quot;lory&quot;</span>
      <span class="n">n_gpu</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="p">},</span>
  <span class="p">]</span>
</pre></div>
</div>
<p>Batch confs that was used to process newly added 10k UKBB images are listed here:</p>
<ul class="simple">
<li><p><span class="xref myst">batch_download.conf</span></p>
<ul>
<li><p>remember to CD into <span class="xref myst">ccitk/ukbb/download</span> directory before running ccitk-slurm-submit</p></li>
<li><p>Maximum you can run is 10 parallel jobs at the same time for downloading as it is limited on the UKBB server side.</p></li>
</ul>
</li>
<li><p><span class="xref myst">batch_convert.conf</span></p></li>
<li><p><span class="xref myst">batch_segment_sa.conf</span></p></li>
<li><p><span class="xref myst">batch_segment_la_2ch.conf</span></p></li>
<li><p><span class="xref myst">batch_segment_la_4ch.conf</span></p></li>
<li><p><span class="xref myst">batch_segment_la_4ch_seg4.conf</span></p></li>
<li><p><span class="xref myst">batch_segment_ao.conf</span></p></li>
<li><p><span class="xref myst">batch_analyze.conf</span></p></li>
</ul>
</section>
<section id="miscellaneous">
<h2>Miscellaneous<a class="headerlink" href="#miscellaneous" title="Permalink to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>ssh sli9@vm-biomedia-slurm.doc.ic.ac.uk

# Create a virtual environment
virtualenv /vol/biomedic2/sli9/ven

# Activate the virtual environment
source /vol/biomedic2/sli9/venv/bin/activate

# Pip install dependencies
cd /vol/biomedic2/sli9/projects/CCITK/
python setup.py develop

export CUDA_HOME=/vol/cuda/11.3.1-cudnn8.2.1/
export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:/vol/cuda/11.3.1-cudnn8.2.1/targets/x86_64-linux/lib

# MIRTK
export PATH=&quot;$PATH:/vol/biomedic2/wbai/git/MIRTK_bin/bin&quot;

# average_3d_ffd
export PATH=$PATH:/vol/biomedic2/wbai/git/ukbb_cardiac/third_party/ubuntu_16.04_bin/

# SLURM job management
sinfo -lNe
cat slurm.roc01.41941.log
tail -f slurm.roc01.41941.log
scancel 41941
</pre></div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="index.html" class="btn btn-neutral float-left" title="UKBB" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../slurm/index.html" class="btn btn-neutral float-right" title="SLURM" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Surui Li.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>