<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Motion &mdash; CCITK  documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/sphinx_highlight.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Register" href="register.html" />
    <link rel="prev" title="Refine" href="refine.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html" class="icon icon-home"> CCITK
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../api/index.html">API</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Applications</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="index.html">CMRSegment</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="readme.html">README</a></li>
<li class="toctree-l3"><a class="reference internal" href="config.html">config</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="pipeline.html">Pipeline</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="pipeline.html#ccitk.cmr_segment.pipeline.CMRPipeline"><code class="docutils literal notranslate"><span class="pre">CMRPipeline</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="preprocess.html">Preprocess</a></li>
<li class="toctree-l4"><a class="reference internal" href="segment.html">Segment</a></li>
<li class="toctree-l4"><a class="reference internal" href="mesh.html">Mesh</a></li>
<li class="toctree-l4"><a class="reference internal" href="refine.html">Refine</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="#">Motion</a></li>
<li class="toctree-l4"><a class="reference internal" href="register.html">Register</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../ukbb/index.html">UKBB</a></li>
<li class="toctree-l2"><a class="reference internal" href="../slurm/index.html">SLURM</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">CCITK</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Applications</a></li>
          <li class="breadcrumb-item"><a href="index.html">CMRSegment</a></li>
          <li class="breadcrumb-item"><a href="pipeline.html">Pipeline</a></li>
      <li class="breadcrumb-item active">Motion</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/app/cmr_segment/motion.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="module-ccitk.cmr_segment.motion">
<span id="motion"></span><h1>Motion<a class="headerlink" href="#module-ccitk.cmr_segment.motion" title="Permalink to this heading"></a></h1>
<dl class="py class">
<dt class="sig sig-object py" id="ccitk.cmr_segment.motion.MotionTracker">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">ccitk.cmr_segment.motion.</span></span><span class="sig-name descname"><span class="pre">MotionTracker</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">param_dir</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Path</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">template_dir</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Path</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ffd_motion_cfg</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">Path</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#ccitk.cmr_segment.motion.MotionTracker" title="Permalink to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>Compute motion by averaging forward motion and backward motion,
transform atlas to subject’s ED mesh in subject space,
apply motion to the transformed atlas, then register each one back to atlas space.</p>
<p>It takes input from</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>/path/
    subject1/
        landmark_ED.vtk                         -&gt;  ED landmarks
        refine/
            seg_lvsa_SR_ED.nii_refined.nii.gz   -&gt;  Refined ED segmentation
        enlarged/
            lvsa_0.nii.gz                       -&gt;  Enlarged phase 0 image
            lvsa_1.nii.gz                       -&gt;  Enlarged phase 1 image
            ...
        mesh/
            LVendo_ED.vtk                       -&gt;  LV Endo ED mesh
            LVepi_ED.vtk                        -&gt;  LV Epi ED mesh
            LVmyo_ED.vtk                        -&gt;  LV Myo ED mesh
            RV_ED.vtk                           -&gt;  RV ED mesh
            RVepi_ED.vtk                        -&gt;  RV Epi ED mesh
    subject2/
        ...
</pre></div>
</div>
<p>and generates output</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>/path/
    subject1/
        motion/
            dof/                                        -&gt; motion transformation files
                ffd_00_to_00.dof.gz                     -&gt; avergaed, composed motion from frame 00 to 00
                ffd_00_to_01.dof.gz                     -&gt; avergaed, composed motion from frame 00 to 01
                ffd_00_to_02.dof.gz                     -&gt; avergaed, composed motion from frame 00 to 02
                ...
                ffd_forward_00_to_01.dof.gz             -&gt; forward motion from frame 00 to 01
                ffd_forward_01_to_02.dof.gz             -&gt; forward motion from frame 01 to 02
                ...
                ffd_comp_forward_00_to_02.dof.gz        -&gt; forward composed motion from frame 00 to 02
                ffd_comp_forward_00_to_03.dof.gz        -&gt; forward composed motion from frame 00 to 03
                ...
                ffd_backward_00_to_24.dof.gz            -&gt; backward motion from frame 00 to 24
                ffd_backward_02_to_01.dof.gz            -&gt; backward motion from frame 02 to 01
                ...
                ffd_comp_backward_00_to_01.dof.gz       -&gt; backward composed motion from frame 00 to 01
                ffd_comp_backward_00_to_02.dof.gz       -&gt; backward composed motion from frame 00 to 02
                ...
            register/                                   -&gt; Intermediate registration results when transforming atlas
                                                           to match subject ED mesh
                lm/                                     -&gt; Atlas mesh after registeration using landmarks
                    mesh/
                        LVendo_ED.vtk
                        LVepi_ED.vtk
                        LVmyo_ED.vtk
                        RV_ED.vk
                    landmarks.dof.gz
                rigid/                                  -&gt; Atlas mesh after rigid registeration
                    mesh/
                    lv_rigid_ED.dof.gz
                    rigid_ED.dof.gz
                    rv_rigid_ED.dof.gz
                affine/                                 -&gt; Atlas mesh after affine registeration
                    mesh/
                    rv_affine_ED.dof.gz
                ffd/                                    -&gt; Atlas mesh after ffd registeration
                    mesh/
                    lv_ffd_ED.dof.gz
                    rv_ffd_ED.dof.gz
            seg/                                        -&gt; Warped ED label according to motion
                lvsa_00.nii.gz
                lvsa_01.nii.gz
                ...
            TXT/                                        -&gt; motion of transformed atlas mesh in atlas space, txt format
                LV_endo/
                    fr00.txt
                    fr01.txt
                    ...
                LV_epi/
                LV_myo/
                RV/
            VTK/                                        -&gt; motion of transformed atlas mesh in atlas space, vtk format
                LV_endo/
                    fr00.vtk
                    fr01.vtk
                    ...
                LV_epi/
                LV_myo/
                RV/
    subject2/
        ...
</pre></div>
</div>
<p>To run only the coregister, use the following command:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>ccitk-cmr-segment -o /output-dir/ --data-dir /input-dir/ --track-motion --template-dir /template-dir
--param-dir /param-dir --ffd-motion-cfg /path-to-cfg
</pre></div>
</div>
<p>Default template dir is <code class="docutils literal notranslate"><span class="pre">ccitk/cmr_segment/resource/params</span></code></p>
<p>Default param dir is <code class="docutils literal notranslate"><span class="pre">ccitk/cmr_segment/resource/</span></code></p>
<p>Default ffd motion cfg is <code class="docutils literal notranslate"><span class="pre">ccitk/cmr_segment/resource/ffd_motion_2.cfg</span></code></p>
<dl class="py method">
<dt class="sig sig-object py" id="ccitk.cmr_segment.motion.MotionTracker.convert_vtks_to_txts">
<em class="property"><span class="pre">static</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">convert_vtks_to_txts</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">vtks</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">Path</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">output_dir</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Path</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">overwrite</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#ccitk.cmr_segment.motion.MotionTracker.convert_vtks_to_txts" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="ccitk.cmr_segment.motion.MotionTracker.run">
<span class="sig-name descname"><span class="pre">run</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">cine</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="../../api/common/resource.html#ccitk.common.resource.CineImages" title="ccitk.common.resource.CineImages"><span class="pre">CineImages</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">ed_segmentation</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="../../api/common/resource.html#ccitk.common.resource.Segmentation" title="ccitk.common.resource.Segmentation"><span class="pre">Segmentation</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">landmarks</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Path</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ED_mesh</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="../../api/common/resource.html#ccitk.common.resource.CardiacMesh" title="ccitk.common.resource.CardiacMesh"><span class="pre">CardiacMesh</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">output_dir</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Path</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">overwrite</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#ccitk.cmr_segment.motion.MotionTracker.run" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

</dd></dl>

</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="refine.html" class="btn btn-neutral float-left" title="Refine" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="register.html" class="btn btn-neutral float-right" title="Register" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Surui Li.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>